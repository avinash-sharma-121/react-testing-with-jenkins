pipeline {
    agent any

    parameters {
        string(
            name: 'DOCKER_IMAGE',
            defaultValue: '',
            description: 'Docker image with tag'
        )
        string(
            name: 'APP_VERSION',
            defaultValue: '',
            description: 'Git commit SHA'
        )
    }

    stages {
        stage('Deploy to Minikube') {
            steps {
                echo "Deploying image: ${params.DOCKER_IMAGE}"
                echo "Version: ${params.APP_VERSION}"

                sh '''
                    kubectl get nodes
                    sed 's|IMAGE_PLACEHOLDER|${params.DOCKER_IMAGE}|g' k8s/deployment.yml | kubectl apply -f -
                    kubectl apply -f k8s/service.yml
                    kubectl get pods -n portfolio
                    '''

        //        sh '''
        //          sed 's|IMAGE_PLACEHOLDER|${params.DOCKER_IMAGE}|g' k8s/deployment.yaml | kubectl apply -f - //kubectl apply -f k8s/service.yaml
        //          kubectl get nodes
        //        '''

            }
        }
    }
}
